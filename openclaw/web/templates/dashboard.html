{% extends "base.html" %}
{% block title %}Dashboard ‚Äî Mike's BS{% endblock %}
{% block content %}
<div class="row g-3 mb-2">
  <div class="col-6 col-md-3">
    <div class="card text-center border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="display-6 fw-bold text-primary">{{ "{:,}".format(total_parcels) }}</div>
        <div class="text-muted small">Parcels Loaded</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="card text-center border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="display-6 fw-bold text-success">{{ "{:,}".format(total_candidates) }}</div>
        <div class="text-muted small">Subdivision Candidates</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="card text-center border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="display-6 fw-bold text-warning">{{ "{:,}".format(new_leads) }}</div>
        <div class="text-muted small">New Leads (7d)</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="card text-center border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="display-6 fw-bold text-info">{{ "{:,}".format(total_leads) }}</div>
        <div class="text-muted small">Total Leads</div>
      </div>
    </div>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-6 col-md-2">
    <div class="card text-center border-0 shadow-sm h-100" style="border-top: 4px solid #198754 !important;">
      <div class="card-body py-2">
        <div class="display-6 fw-bold text-success">{{ "{:,}".format(tier_a) }}</div>
        <div class="text-muted small">Tier A ‚Äî Prime</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-2">
    <div class="card text-center border-0 shadow-sm h-100" style="border-top: 4px solid #0d6efd !important;">
      <div class="card-body py-2">
        <div class="display-6 fw-bold text-primary">{{ "{:,}".format(tier_b) }}</div>
        <div class="text-muted small">Tier B ‚Äî Good</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-2">
    <div class="card text-center border-0 shadow-sm h-100" style="border-top: 4px solid #ffc107 !important;">
      <div class="card-body py-2">
        <div class="display-6 fw-bold text-warning">{{ "{:,}".format(tier_c) }}</div>
        <div class="text-muted small">Tier C ‚Äî Decent</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-2">
    <div class="card text-center border-0 shadow-sm h-100" style="border-top: 4px solid #fd7e14 !important;">
      <div class="card-body py-2">
        <div class="display-6 fw-bold" style="color:#fd7e14">{{ "{:,}".format(tier_d) }}</div>
        <div class="text-muted small">Tier D ‚Äî Marginal</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-2">
    <div class="card text-center border-0 shadow-sm h-100" style="border-top: 4px solid #dc3545 !important;">
      <div class="card-body py-2">
        <div class="display-6 fw-bold text-danger">{{ "{:,}".format(tier_e) }}</div>
        <div class="text-muted small">Tier E ‚Äî Weak</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-2">
    <div class="card text-center border-0 shadow-sm h-100" style="border-top: 4px solid #212529 !important;">
      <div class="card-body py-2">
        <div class="display-6 fw-bold text-dark">{{ "{:,}".format(tier_f) }}</div>
        <div class="text-muted small">Tier F ‚Äî Skip</div>
      </div>
    </div>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <h6 class="card-title fw-bold">Candidates by Tier</h6>
        <canvas id="tierChart" height="180"></canvas>
      </div>
    </div>
  </div>
  <div class="col-md-8">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <h6 class="card-title fw-bold">üî• Top Tier A Deals</h6>
        <div class="table-responsive">
          <table class="table table-sm table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>Address</th>
                <th>Owner</th>
                <th>Lot Size</th>
                <th>Splits</th>
                <th>Land Value</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for c in top5 %}
              <tr>
                <td class="fw-semibold">{{ c.parcel.address or "‚Äî" }}</td>
                <td class="text-muted small">{{ c.parcel.owner_name or "‚Äî" }}</td>
                <td class="small">{{ c.parcel.lot_sf | acres }}</td>
                <td><span class="badge bg-success">{{ c.potential_splits }}</span></td>
                <td class="small">{{ c.estimated_land_value | money }}</td>
                <td><a href="{{ base_url }}/candidates" class="btn btn-sm btn-outline-primary py-0">View</a></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-md-4">
    <a href="{{ base_url }}/candidates?tier=A" class="card text-decoration-none border-success border-2 h-100">
      <div class="card-body text-center py-4">
        <div class="fs-1">üèÜ</div>
        <div class="fs-4 fw-bold text-success">{{ "{:,}".format(tier_a) }} Tier A</div>
        <div class="text-muted">Best subdivision deals<br>4+ potential splits</div>
      </div>
    </a>
  </div>
  <div class="col-md-4">
    <a href="{{ base_url }}/candidates?tier=B" class="card text-decoration-none border-warning border-2 h-100">
      <div class="card-body text-center py-4">
        <div class="fs-1">‚úÖ</div>
        <div class="fs-4 fw-bold text-warning">{{ "{:,}".format(tier_b) }} Tier B</div>
        <div class="text-muted">Good subdivision deals<br>2‚Äì3 potential splits</div>
      </div>
    </a>
  </div>
  <div class="col-md-4">
    <a href="{{ base_url }}/map" class="card text-decoration-none border-primary border-2 h-100">
      <div class="card-body text-center py-4">
        <div class="fs-1">üó∫Ô∏è</div>
        <div class="fs-4 fw-bold text-primary">View Map</div>
        <div class="text-muted">See all candidates<br>plotted on the map</div>
      </div>
    </a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
<script>
new Chart(document.getElementById('tierChart'), {
  type: 'doughnut',
  data: {
    labels: ['Tier A', 'Tier B', 'Tier C', 'Tier D', 'Tier E', 'Tier F'],
    datasets: [{
      data: {{ tier_data_json }},
      backgroundColor: ['#198754','#0d6efd','#ffc107','#fd7e14','#dc3545','#212529'],
      borderWidth: 2,
    }]
  },
  options: { plugins: { legend: { position: 'bottom' } } }
});
</script>
{% endblock %}
